âš ï¸ ATENÃ‡ÃƒO! Cuidados importantes apÃ³s a instalaÃ§Ã£o: âš ï¸

1ï¸âƒ£ UsuÃ¡rio Admin: â›” Nunca delete o usuÃ¡rio admin (ID 1) e a empresa criada durante a instalaÃ§Ã£o!

2ï¸âƒ£ Editar Superadmin: âœï¸ Ao editar os dados do usuÃ¡rio superadmin, preencha o campo "senha atual" ou defina uma nova senha.

âš ï¸ IMPORTANTE: Se vocÃª deixar o campo de senha em branco, o sistema salvarÃ¡ a senha como vazia no banco de dados.

3ï¸âƒ£ Habilitar Campanhas: ğŸš€ Para habilitar o envio de campanhas, acesse "ConfiguraÃ§Ãµes" âš™ï¸ e depois "Empresas". ğŸ¢ ApÃ³s ativar as campanhas, faÃ§a logout e login novamente para que o menu de campanhas apareÃ§a. ğŸ”„

4ï¸âƒ£ Plano 1: ğŸ—‘ï¸ O Plano 1 pode ser excluÃ­do. Ele nÃ£o permite a alteraÃ§Ã£o do nome, mas, ao excluÃ­-lo, lembre-se de vincular um novo plano Ã  empresa 1. ğŸ”„ Caso contrÃ¡rio, vocÃª nÃ£o poderÃ¡ adicionar conexÃµes, filas e novos usuÃ¡rios.

5ï¸âƒ£ Gerenciamento de HorÃ¡rios: â° Ao mudar o gerenciamento de horÃ¡rios (por fila ou por empresa), limpe os campos preenchidos da opÃ§Ã£o atual.
Exemplo: se vocÃª mudar de um gerenciamento de horÃ¡rio por fila para por empresa, acesse os horÃ¡rios das filas e deixe os campos em branco para apagar as informaÃ§Ãµes do banco de dados. ğŸ—‘ï¸
FaÃ§a o mesmo ao trocar de um gerenciamento de horÃ¡rio de empresa para fila ou ao desativar os horÃ¡rios, limpando os campos atualmente ativos.

Seguindo essas dicas, vocÃª garante o bom funcionamento do sistema e evita problemas de configuraÃ§Ã£o. ğŸ˜‰

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸš¨ Resolvendo Erros Internos ApÃ³s a InstalaÃ§Ã£o: ğŸš¨

Se vocÃª encontrar um erro interno apÃ³s a instalaÃ§Ã£o, siga estes passos para repopular o banco de dados:

1ï¸âƒ£ Acesse o diretÃ³rio do backend:

cd /home/deploy/***/backend 

Substitua *** pelo nome da sua instÃ¢ncia.

2ï¸âƒ£ Execute os comandos para migrar e popular o banco de dados:

npx sequelize db:migrate
npx sequelize db:seed:all

3ï¸âƒ£ Acesse o usuÃ¡rio "deploy":

su deploy

4ï¸âƒ£ Reinicie todos os processos e limpe os logs:

pm2 restart all
pm2 flush 0
pm2 flush 1

ExplicaÃ§Ã£o dos comandos:

npx sequelize db:migrate: Executa as migraÃ§Ãµes do banco de dados, garantindo que a estrutura esteja correta. ğŸ—ï¸
npx sequelize db:seed:all: Popula o banco de dados com dados iniciais, como configuraÃ§Ãµes padrÃ£o e permissÃµes. ğŸŒ±
pm2 restart all: Reinicia todos os processos gerenciados pelo PM2, incluindo o frontend e o backend. ğŸ”„
pm2 flush 0 e pm2 flush 1: Limpa os logs dos processos, removendo informaÃ§Ãµes antigas que podem estar causando conflitos. ğŸ§¹
ApÃ³s seguir esses passos, o erro interno deve ser corrigido. âœ¨ Se o problema persistir, consulte a documentaÃ§Ã£o ou procure ajuda no suporte tÃ©cnico. ğŸ§‘â€ğŸ’»

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸ› ï¸ Corrigindo erros de atualizaÃ§Ã£o de pÃ¡gina no Nginx: ğŸ› ï¸

Parece que vocÃª estÃ¡ enfrentando problemas com o Nginx e a atualizaÃ§Ã£o de pÃ¡ginas. Adicionar o cabeÃ§alho underscores_in_headers on; pode resolver esse problema.

Siga estes passos:

1ï¸âƒ£ Acesse o arquivo de configuraÃ§Ã£o do Nginx:

nano /etc/nginx/nginx.conf

2ï¸âƒ£ Adicione o cabeÃ§alho:

Procure a linha # server_tokens off; no arquivo e adicione a linha underscores_in_headers on; logo acima dela.

Seu arquivo nginx.conf deve ficar parecido com isto:

...
underscores_in_headers on;
# server_tokens off;
...

3ï¸âƒ£ Salve as alteraÃ§Ãµes:

Pressione Ctrl + X, depois Y e Enter para salvar as alteraÃ§Ãµes no arquivo.

4ï¸âƒ£ Teste a configuraÃ§Ã£o do Nginx:

nginx -t

Se o teste retornar "OK", a configuraÃ§Ã£o estÃ¡ correta. ğŸ‘

5ï¸âƒ£ Recarregue o serviÃ§o Nginx:

service nginx reload

Isso aplicarÃ¡ as alteraÃ§Ãµes sem precisar reiniciar completamente o servidor. ğŸ”„

ExplicaÃ§Ã£o:

O cabeÃ§alho underscores_in_headers on; permite que o Nginx processe cabeÃ§alhos HTTP que contenham underscores ( _ ), o que pode ser necessÃ¡rio para algumas aplicaÃ§Ãµes web que usam esse caractere em seus cabeÃ§alhos.

Dicas:

Se o erro persistir, verifique o log de erros do Nginx para obter mais informaÃ§Ãµes sobre o problema. ğŸ•µï¸â€â™‚ï¸
Certifique-se de que vocÃª tem permissÃµes de root ou sudo para editar o arquivo nginx.conf. ğŸ§‘â€ğŸ”§
Se vocÃª nÃ£o tiver certeza de como editar arquivos de configuraÃ§Ã£o, peÃ§a ajuda a um profissional. ğŸ‘¨â€ğŸ’»
Espero que isso ajude a resolver o problema! ğŸ˜‰

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸš¨ Corrigindo o PM2 apÃ³s o Reboot: ğŸš¨

Se, apÃ³s reiniciar o servidor, o comando pm2 status nÃ£o listar suas aplicaÃ§Ãµes, siga estes passos para corrigir o problema:

1ï¸âƒ£ Reinicie as aplicaÃ§Ãµes manualmente:

Frontend:

sudo su - deploy
cd /home/deploy/*nome do app*/frontend
sudo pm2 start server.js --name *nome do app*-frontend
sudo pm2 save --force

Backend:

sudo su - deploy
cd /home/deploy/nome do app/backend
sudo pm2 start dist/server.js --name *nome do app*-backend
sudo pm2 save --force

Substitua *nome do app* pelo nome real da sua aplicaÃ§Ã£o.

2ï¸âƒ£ Configure o PM2 para iniciar automaticamente na inicializaÃ§Ã£o do sistema:

Caso o problema persista apÃ³s reiniciar o servidor novamente, execute os seguintes comandos como root:

sudo su - root
pm2 startup
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u deploy --hp /home/deploy

ExplicaÃ§Ã£o dos comandos:

pm2 start server.js --name *nome do app*-frontend: Inicia a aplicaÃ§Ã£o frontend com o PM2 e define um nome para ela.
pm2 start dist/server.js --name *nome do app*-backend: Inicia a aplicaÃ§Ã£o backend com o PM2 e define um nome para ela.
pm2 save --force: Salva a configuraÃ§Ã£o atual do PM2, incluindo as aplicaÃ§Ãµes que foram iniciadas.
pm2 startup: Gera o comando necessÃ¡rio para configurar o PM2 para iniciar automaticamente na inicializaÃ§Ã£o do sistema.
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u deploy --hp /home/deploy: Configura o PM2 para iniciar como um serviÃ§o systemd com o usuÃ¡rio "deploy".
ObservaÃ§Ãµes:

Esses comandos devem ser executados como root.
Certifique-se de que o PM2 esteja instalado corretamente em seu servidor.
Se vocÃª ainda tiver problemas, consulte a documentaÃ§Ã£o do PM2 para obter mais informaÃ§Ãµes sobre como configurar a inicializaÃ§Ã£o automÃ¡tica.
Com essas correÃ§Ãµes, suas aplicaÃ§Ãµes devem iniciar automaticamente apÃ³s a reinicializaÃ§Ã£o do servidor e o pm2 status listarÃ¡ os aplicativos corretamente. ğŸ˜‰

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸš€ ReinicializaÃ§Ã£o Programada das AplicaÃ§Ãµes Node com Cron Jobs: ğŸš€

Para garantir o bom funcionamento do Baileys e evitar problemas de conexÃ£o, vamos configurar reinicializaÃ§Ãµes programadas do frontend e backend usando o cron.

1ï¸âƒ£ Acesse o editor de crontab:

crontab -e

Se solicitado, escolha seu editor de texto preferido. Usaremos o nano como exemplo.

2ï¸âƒ£ Adicione a linha de comando para reiniciar as aplicaÃ§Ãµes a cada 12 horas:

0 */12 * * * /usr/bin/node /usr/bin/pm2 restart all

* ExplicaÃ§Ã£o do comando:
0 */12 * * *: Define a execuÃ§Ã£o do comando a cada 12 horas (Ã s 00:00 e 12:00).
/usr/bin/node /usr/bin/pm2 restart all: Utiliza o Node.js para executar o comando pm2 restart all, que reinicia todas as aplicaÃ§Ãµes gerenciadas pelo PM2.

3ï¸âƒ£ Salve as alteraÃ§Ãµes no crontab:

No nano, pressione Ctrl + X, depois Y e Enter.

Outras opÃ§Ãµes de configuraÃ§Ã£o:

VocÃª pode ajustar o intervalo de reinicializaÃ§Ã£o no crontab de acordo com suas necessidades.
Para gerar diferentes modelos de cron, utilize os sites:
https://crontab.guru/
https://crontab-generator.org/
https://crontab.cronhub.io/

ObservaÃ§Ãµes:

O comando pm2 restart all reinicia todos os processos gerenciados pelo PM2. Se vocÃª quiser reiniciar apenas as aplicaÃ§Ãµes do Baileys, especifique os nomes dos processos no comando.
Certifique-se de que o PM2 esteja instalado e configurado corretamente em seu servidor.
Monitorar os logs do sistema e das aplicaÃ§Ãµes apÃ³s implementar a reinicializaÃ§Ã£o programada Ã© importante para identificar possÃ­veis problemas.
Com essa configuraÃ§Ã£o, vocÃª garante que as aplicaÃ§Ãµes Node.js sejam reiniciadas regularmente, minimizando problemas de conexÃ£o e mantendo o Baileys funcionando sem interrupÃ§Ãµes. ğŸ‰

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸ§° Comandos Ãšteis para Node.js e PM2: ğŸ§°

Aqui estÃ£o alguns comandos que podem ser Ãºteis para gerenciar suas aplicaÃ§Ãµes Node.js com o PM2:

Build/Re-build:

sudo npm run build

Este comando executa o script de build definido no seu arquivo package.json, geralmente usado para compilar e preparar o cÃ³digo para produÃ§Ã£o.
Atualizar bibliotecas:

npm update --force

Atualiza todas as dependÃªncias do seu projeto para as versÃµes mais recentes. O --force forÃ§a a atualizaÃ§Ã£o mesmo se houver conflitos de versÃ£o.
Reiniciar PM2:

pm2 restart all

Reinicia todos os processos gerenciados pelo PM2.
Logs:

pm2 log

Exibe os logs de todos os processos gerenciados pelo PM2.
Limpeza de logs:

pm2 flush <id>

Limpa os logs do processo com o ID especificado. Substitua <id> pelo ID do processo.
Dicas:

Utilize o comando pm2 list para visualizar a lista de processos gerenciados pelo PM2 e seus IDs.
O PM2 possui muitos outros comandos Ãºteis. Consulte a documentaÃ§Ã£o do PM2 para mais informaÃ§Ãµes: https://pm2.keymetrics.io/docs/usage/quick-start/
Espero que esta lista seja Ãºtil! ğŸ˜‰

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸ˜ Acessando o PostgreSQL com PGAdmin4 e TÃºnel SSH: ğŸ˜

Para acessar o banco de dados PostgreSQL da sua aplicaÃ§Ã£o, vocÃª pode usar o PGAdmin4 com um tÃºnel SSH. Isso garante uma conexÃ£o segura e criptografada, protegendo suas credenciais.

Siga estes passos:

1ï¸âƒ£ Obtenha as credenciais do banco de dados:

Acesse o arquivo .env na pasta backend da sua aplicaÃ§Ã£o.
Anote os valores das seguintes variÃ¡veis:
DB_HOST
DB_USER
DB_PASS
DB_NAME
DB_PORT

2ï¸âƒ£ Configure o tÃºnel SSH no PGAdmin4:

Abra o PGAdmin4 e clique com o botÃ£o direito em "Servers" na barra lateral.

Selecione "Create" -> "Server..."

Na aba "General", dÃª um nome ao seu servidor.

Na aba "Connection":

Host name/address: localhost (ou 127.0.0.1)
Port: A porta que vocÃª configurou para o tÃºnel SSH (ex: 5432).
Maintenance database: postgres
Username: O valor da variÃ¡vel DB_USER do arquivo .env.
Password: O valor da variÃ¡vel DB_PASS do arquivo .env.
Clique na aba "SSH Tunnel" e marque a opÃ§Ã£o "Use SSH Tunnel".

Preencha os campos com as informaÃ§Ãµes do seu servidor:

Hostname: O endereÃ§o IP do seu servidor.
Port: A porta SSH padrÃ£o (geralmente 22).
Username: O nome de usuÃ¡rio root do seu servidor.
Authentication: Selecione "Password" e digite a senha do usuÃ¡rio root.

3ï¸âƒ£ Salve a configuraÃ§Ã£o e conecte-se ao servidor:

Clique em "Save" para salvar a configuraÃ§Ã£o do servidor.
Agora vocÃª pode se conectar ao servidor clicando duas vezes no nome dele na barra lateral do PGAdmin4.
ObservaÃ§Ãµes:

Certifique-se de que o PGAdmin4 esteja instalado na sua mÃ¡quina local.
Se vocÃª estiver usando uma chave SSH para autenticar no servidor, selecione a opÃ§Ã£o "Key file" na aba "SSH Tunnel" e informe o caminho para sua chave privada.
Se vocÃª tiver um firewall ativo na sua mÃ¡quina local, certifique-se de que a porta que vocÃª configurou para o tÃºnel SSH esteja aberta.
Com essas instruÃ§Ãµes, vocÃª poderÃ¡ acessar seu banco de dados PostgreSQL de forma segura e gerenciar seus dados com o PGAdmin4. ğŸ˜

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸ”´ Testando a ConexÃ£o e AutenticaÃ§Ã£o do Redis: ğŸ”´

Ã‰ importante garantir que o Redis esteja configurado corretamente e que a senha definida funcione para proteger seu banco de dados de agendamento.

Siga estes passos para testar a conexÃ£o e autenticaÃ§Ã£o:

1ï¸âƒ£ Identifique o ID do contÃªiner Docker do Redis:

docker ps

Anote o CONTAINER ID do Redis na lista exibida.

2ï¸âƒ£ Acesse o contÃªiner do Redis:

docker exec -it <CONTAINER ID> bash

Substitua <CONTAINER ID> pelo ID que vocÃª anotou no passo anterior.

3ï¸âƒ£ Conecte-se ao cliente Redis:

redis-cli

4ï¸âƒ£ Tente definir uma chave antes da autenticaÃ§Ã£o (este comando deve falhar):

set teste 123
VocÃª deve receber a mensagem de erro: (error) NOAUTH Authentication required.

5ï¸âƒ£ Autentique-se com a senha definida no arquivo de configuraÃ§Ã£o do Redis:

auth sua_senha

Substitua sua_senha pela senha real que vocÃª configurou.

6ï¸âƒ£ Teste a conexÃ£o apÃ³s a autenticaÃ§Ã£o:

ping

VocÃª deve receber a resposta: pong.

7ï¸âƒ£ Saia do cliente Redis:

quit

ObservaÃ§Ãµes:

Se vocÃª nÃ£o conseguir se conectar ao Redis ou se a autenticaÃ§Ã£o falhar, verifique se a senha estÃ¡ correta no arquivo de configuraÃ§Ã£o do Redis e se o serviÃ§o estÃ¡ em execuÃ§Ã£o.
Se vocÃª nÃ£o definiu uma senha para o Redis, o comando auth nÃ£o serÃ¡ necessÃ¡rio. No entanto, Ã© altamente recomendÃ¡vel definir uma senha para proteger seu banco de dados.
Para obter mais informaÃ§Ãµes sobre como configurar e gerenciar o Redis, consulte a documentaÃ§Ã£o oficial: https://redis.io/docs/
Com este teste, vocÃª confirma que o Redis estÃ¡ funcionando corretamente e que a senha de autenticaÃ§Ã£o estÃ¡ configurada e ativa. âœ…

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

8ï¸âƒ£ Limpe mÃ­dias antigas:

Para remover mÃ­dias com mais de 30 dias, execute o seguinte comando:

find /home/deploy/*/backend/public -type f -mtime +30 -delete

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸ”¥ Particularidades da VPSDime - Preparando o Terreno: ğŸ”¥

A VPSDime tem algumas peculiaridades que exigem atenÃ§Ã£o antes da instalaÃ§Ã£o. Siga estes passos para garantir um processo tranquilo:

1ï¸âƒ£ Atualize os pacotes do servidor:

sudo apt -y update && apt -y upgrade

2ï¸âƒ£ Instale e configure o firewall (UFW):

sudo apt-get install ufw
sudo ufw enable

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 3000/tcp
sudo ufw allow 4000/tcp
sudo ufw allow 5000/tcp
sudo ufw allow 5432/tcp
sudo ufw allow 6379/tcp

sudo ufw status

IMPORTANTE: Libere a porta SSH (22) para nÃ£o perder o acesso ao servidor! ğŸ§±ğŸ”“
3ï¸âƒ£ Instale o Curl:

sudo apt-get install curl

4ï¸âƒ£ Defina a versÃ£o do Node.js para a 20:

curl -sL https://deb.nodesource.com/setup_20.x | sudo -E bash -

A VPSDime, por padrÃ£o, instala a versÃ£o 10 do Node.js. Este comando garante que a versÃ£o 20 seja instalada. âš™ï¸
ObservaÃ§Ãµes:

O UFW Ã© um firewall simples e eficiente para proteger seu servidor.
O Curl Ã© uma ferramenta para transferir dados de ou para um servidor, e serÃ¡ usado para instalar a versÃ£o correta do Node.js.
A versÃ£o 20 do Node.js oferece melhor desempenho e compatibilidade com as bibliotecas mais recentes.
Seguindo estas instruÃ§Ãµes, vocÃª terÃ¡ o ambiente da VPSDime pronto para a instalaÃ§Ã£o da sua aplicaÃ§Ã£o! ğŸš€

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

ğŸ’£ Deletar e Recriar o Banco de Dados: ğŸ’£

Em alguns casos, pode ser necessÃ¡rio deletar e recriar o banco de dados para corrigir problemas ou reiniciar a aplicaÃ§Ã£o do zero. Siga este guia com atenÃ§Ã£o:

1ï¸âƒ£ Pare as aplicaÃ§Ãµes:

su deploy
pm2 stop all
exit

2ï¸âƒ£ Acesse o PostgreSQL como usuÃ¡rio "postgres":

sudo su - postgres

3ï¸âƒ£ Delete o banco de dados:

SQL
dropdb *nomedoapp*;

4ï¸âƒ£ Recrie o banco de dados:

SQL
createdb *nomedoapp*;

5ï¸âƒ£ Crie o usuÃ¡rio e defina a senha:

SQL
psql
CREATE USER *nomedoapp* SUPERUSER INHERIT CREATEDB CREATEROLE;
ALTER USER *nomedoapp* PASSWORD '*senhadeploy*';
\q
exit

Substitua *nomedoapp* pelo nome do seu app e *senhadeploy* pela senha do usuÃ¡rio deploy.

6ï¸âƒ£ Execute as migraÃ§Ãµes e seeders:

su deploy
cd /home/deploy/*nomedoapp*/backend

npx sequelize db:migrate
npx sequelize db:seed:all

Substitua *nomedoapp* pelo nome do seu app.

7ï¸âƒ£ Reinicie as aplicaÃ§Ãµes:

su deploy
cd
pm2 restart all

ObservaÃ§Ãµes:

FaÃ§a backup do seu banco de dados antes de deletÃ¡-lo! âš ï¸
Este procedimento apagarÃ¡ todos os dados do banco de dados.
Certifique-se de ter as credenciais corretas do banco de dados antes de prosseguir.
Se vocÃª tiver dÃºvidas, consulte a documentaÃ§Ã£o ou procure ajuda no suporte tÃ©cnico.
Com este guia, vocÃª poderÃ¡ deletar e recriar o banco de dados do seu aplicativo de forma segura. ğŸ—‘ï¸ğŸ”„